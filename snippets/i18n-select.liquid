{%- doc -%}
  Renders a form for selecting the store's language or currency.

  @param {string} [class] - Additional CSS classes to apply to the wrapper element.
{%- enddoc -%}

{%- liquid
  assign form_id = 'Footer' | append: type | append: 'Form'
  assign show_flags = true
-%}

{%- capture wrapper_class -%}
  locale-selectors {{ class }}
{%- endcapture -%}

{%- form 'localization', id: form_id, class: 'min-w-25' -%}
  {%- if type == 'currency' -%}
    {%- assign label = 'localization.country_label' | t -%}

    {%- capture id -%}
      {{ form_id }}_country_code
    {%- endcapture -%}

    {%- capture options -%}
      {%- for country in localization.available_countries -%}
        {% assign country_code = country.iso_code | escape | downcase %}
        <option
          value='{{ country.iso_code }}'
          {% if show_flags %}
            data-img-url='https://cdn.shopify.com/static/images/flags/{{ country_code }}.svg?width=13&height=10'
            data-img-alt='{{ country.name }}'
          {% endif %}
          {% if country.iso_code == localization.country.iso_code %}
            selected
          {% endif %}
        >
          {{ country.currency.iso_code }}
          ({{ country.currency.symbol }})
        </option>
      {%- endfor -%}
    {%- endcapture -%}

    {%- render 'form-field',
      kind: 'select',
      name: 'country_code',
      id: id,
      label: label,
      value: localization.country.iso_code,
      options: options,
      wrapper_class: wrapper_class,
      custom_select: true,
      attributes: 'onchange="this.form?.submit()"'
    -%}
  {%- endif -%}

  {%- if type == 'language' -%}
    {% assign locale_label = 'localization.language_label' | t %}

    {%- capture locale_id -%}
      {{ form_id }}_locale_code
    {%- endcapture -%}

    {% capture locale_options %}
      {%- for language in localization.available_languages -%}
        <option
          value='{{ language.iso_code }}'
          {% if language.iso_code == localization.language.iso_code %}
            selected
          {% endif %}
        > 
          {{ language.endonym_name | capitalize }}
        </option>
      {%- endfor -%}
    {% endcapture %}

    {%- render 'form-field',
      kind: 'select',
      name: 'locale_code',
      id: locale_id,
      label: locale_label,
      value: localization.language.iso_code,
      options: locale_options,
      wrapper_class: wrapper_class,
      custom_select: true,
      attributes: 'onchange="this.form?.submit()"'
    -%}
  {%- endif -%}
{%- endform -%}
