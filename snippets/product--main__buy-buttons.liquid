{% comment %}
  Renders product buy-buttons.
  Accepts:
  - product: {Object} product object.
  - block: {Object} passing the block information.
  - product_form_id: {String} product form id.
  - section_id: {String} id of section to which this snippet belongs.
  - color_scheme: {String} for the color scheme. Accepts 'background-contrast', 'background', 'primary', 'secondary'. Default is 'background-contrast' (optional).
  - show_quantity_selector: {Boolean} for quantity selector. If true the quantity selector will overlay the add to cart button

  Usage:
  {% render 'product--main__buy-buttons', block: block, product: product, product_form_id: product_form_id, section_id: section.id %}
{% endcomment %}
<div
  {{ block.shopify_attributes }}
  sub-section-id='{{ block.id }}'
  class='{% if show_quantity_selector %}relative{% endif %}'
>
  {% if show_quantity_selector %}
    {%- render 'product--main__quantity-selector',
      block: block,
      section: section,
      product: product,
      selected_variant: selected_variant,
      product_form_id: product_form_id,
      quantity_classes: 'absolute'
    -%}
  {% endif %}

  {%- if product != blank -%}
    {%- liquid
      assign gift_card_recipient_feature_active = false
      if block.settings.show_gift_card_recipient and product.gift_card?
        assign gift_card_recipient_feature_active = true
      endif

      assign show_dynamic_checkout = false
      if block.settings.show_dynamic_checkout and gift_card_recipient_feature_active == false
        assign show_dynamic_checkout = true
      endif
    -%}

    <product-form
      class='group/product-form {{ color_scheme }}'
    >
      <div class='product-form__error-message-wrapper' role='alert' hidden>
        {%- render 'icon' with 'icon-error' -%}
        <span class='product-form__error-message'></span>
      </div>

      {%- form 'product',
        product,
        id: product_form_id,
        class: 'group-[.loading]/product-form:pointer-events-none',
        novalidate: 'novalidate',
        data-type: 'add-to-cart-form'
      -%}
        <input
          type='hidden'
          name='id'
          class='hidden'
          value='{{ product.selected_or_first_available_variant.id }}'
          {% if product.selected_or_first_available_variant.available == false
            or quantity_rule_soldout
            or product.selected_or_first_available_variant == null
          %}
            disabled
          {% endif %}
        >

        {%- if gift_card_recipient_feature_active -%}
          {%- render 'gift-card-recipient-form',
            product: product,
            form: form,
            section: section,
            form_id: product_form_id
          -%}
        {%- endif -%}

        <div class='grid grid-cols-1 gap-y-xs'>
          {%- liquid
            assign check_against_inventory = true
            if product.selected_or_first_available_variant.inventory_management != 'shopify' or product.selected_or_first_available_variant.inventory_policy == 'continue'
              assign check_against_inventory = false
            endif
            if product.selected_or_first_available_variant.quantity_rule.min > product.selected_or_first_available_variant.inventory_quantity and check_against_inventory
              assign quantity_rule_soldout = true
            endif
          -%}
          <button
            id='ProductSubmitButton-{{ section_id }}'
            type='submit'
            name='add'
            variant='{% if show_dynamic_checkout %}secondary{% else %}primary{% endif %}'
            class='btn'
            {% if product.selected_or_first_available_variant.available == false
              or quantity_rule_soldout
              or product.selected_or_first_available_variant == null
            %}
              disabled
            {% endif %}
          >
            <span>
              {% render 'icon' with 'icon-asterisk', size: 12, attributes: 'aria-hidden', class: 'relative top-px' %}
              {%- if product.selected_or_first_available_variant == null -%}
                {{ 'products.product.unavailable' | t }}
              {%- elsif product.selected_or_first_available_variant.available == false or quantity_rule_soldout -%}
                {{ 'products.product.sold_out' | t }}
              {%- else -%}
                {{ 'products.product.add_to_cart' | t }}
              {%- endif -%}
            </span>
          </button>
          {%- if show_dynamic_checkout -%}
            {{ form | payment_button }}
          {%- endif -%}
        </div>
      {%- endform -%}
    </product-form>
  {%- else -%}
    <div class='product-form'>
      <div class='product-form__buttons form'>
        <button
          type='submit'
          name='add'
          variant='primary'
          class='btn'
          disabled
        >
          {{ 'products.product.sold_out' | t }}
        </button>
      </div>
    </div>
  {%- endif -%}
</div>

<style>
  .shopify-payment-button__more-options[aria-hidden='true'] {
    display: none;
  }

  .shopify-payment-button__button {
    border-radius: var(--button-border-radius, 0.25rem);
  }
</style>
