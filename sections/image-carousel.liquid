{%- liquid
  assign slides = section.blocks | where: 'type', 'slide'

  assign fetch_priority = 'auto'
  assign lazy_load = 'lazy'

  if section.index == 1
    assign fetch_priority = 'high'
    assign lazy_load = 'eager'
  endif

  capture color_scheme
    render '@color-scheme', color_scheme: section.settings.color_scheme
  endcapture
-%}
{% render '@needs-script', entries: 'core-carousel' %}

<core-carousel
  class='{{ color_scheme }} mt-md'
  role='group'
  aria-label='{{ section.settings.title | default: 'image carousel' | append: section.index }}'
  {% if section.settings.enable_auto_rotate or section.settings.loop %}
    data-loop='true'
  {% endif %}
  {% if section.settings.enable_auto_rotate and section.settings.rotate_speed > 0 %}
    data-slide-interval='{{ section.settings.rotate_speed | times: 1000 }}'
  {% endif %}
>
  {% if section.settings.show_dots %}
    <div
      class='core-carousel-nav-dots'
      role='group'
      aria-label='Choose slide to display'
      data-nav-dots-wrapper
    ></div>
  {% endif %}

  {% if section.settings.show_arrows %}
    <div class='container px-pagemargin inset-0 flex justify-between items-center h-full w-full absolute'>
      <button
        class='core-carousel-button core-carousel-button-prev'
        data-carousel-prev
        {% if section.settings.loop == false %}
          disabled
        {% endif %}
        aria-label='{{ 'general.slider.previous_slide' | t }}'
      >
        {% render 'icon' with 'icon-caret', class: 'rotate-90' %}
      </button>
      <button
        class='core-carousel-button core-carousel-button-next'
        data-carousel-next
        aria-label='{{ 'general.slider.next_slide' | t }}'
      >
        {% render 'icon' with 'icon-caret', class: '-rotate-90' %}
      </button>
    </div>
  {% endif %}

  {% if section.settings.show_progress_bar %}
    {% assign slides_size = 100.00 | divided_by: slides.size %}

    <div class='core-carousel-progress' data-progress style='--min-scroll-width: {{ slides_size }}%'>
      <div class='core-carousel-progress-thumb'></div>
    </div>
  {% endif %}

  <div
    class='core-carousel-slides'
    aria-atomic='false'
    aria-live='{% if section.settings.enable_auto_rotate %}off{% else %}polite{% endif %}'
    data-carousel-slides
  >
    {% for block in slides %}
      {% assign image_desktop = block.settings.image | default: block.settings.mobile_image %}
      {% assign image_mobile = block.settings.mobile_image | default: image_desktop %}
      <div
        class='core-carousel-slide'
        role='group'
        aria-label='{{ forloop.index }} of {{ forloop.length }}'
        aria-roledescription='slide'
        data-carousel-slide
      >
        {% if image_mobile != blank and image_desktop != blank %}
          {% render 'picture',
            mobile_image: image_mobile,
            image: image_desktop,
            sizes: '100vw',
            object_fit: 'cover',
            loading: lazy_load,
            fetchpriority: fetch_priority,
            class: 'absolute inset-0 w-full h-full'
          %}
        {% else %}
          <div class='inset-0 w-full h-full absolute'>
            {{ 'lifestyle-2' | placeholder_svg_tag: 'w-full h-full' }}
          </div>
        {% endif %}

        <div class='relative z-[1] w-full h-full py-pagemargin grid grid-cols-1 items-center container'>
          <div class='grid grid-cols-1 gap-y-xs {{ block.settings.alignment }} md:max-w-[50%]'>
            {% if block.settings.title != blank %}
              <h2 class='h2 text-balance'>{{ block.settings.title | newline_to_br }}</h2>
            {% endif %}

            {% if block.settings.subtitle != blank %}
              <h3 class='h5 text-balance'>
                {{ block.settings.subtitle | newline_to_br }}
              </h3>
            {% endif %}

            {% if block.settings.link_label != blank %}
              <a
                variant='tertiary'
                class='underline hover:decoration-2 underline-offset-4'
                href='{{ block.settings.link }}'
              >
                {{ block.settings.link_label | escape }}
              </a>
            {% endif %}
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
</core-carousel>

{% schema %}
{
  "name": "t:sections.image-carousel.name",
  "tag": "section",
  "settings": [
    {
      "type": "checkbox",
      "id": "enable_auto_rotate",
      "label": "t:sections.image-carousel.settings.enable_auto_rotate.label",
      "default": true
    },
    {
      "type": "range",
      "id": "rotate_speed",
      "min": 3,
      "max": 9,
      "step": 1,
      "label": "t:sections.image-carousel.settings.rotate_speed.label",
      "unit": "t:sections.image-carousel.settings.rotate_speed.unit",
      "default": 5
    },
    {
      "type": "checkbox",
      "id": "show_arrows",
      "label": "t:sections.image-carousel.settings.show_arrows.label",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_dots",
      "label": "t:sections.image-carousel.settings.show_dots.label",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_progress_bar",
      "label": "t:sections.image-carousel.settings.show_progress_bar.label",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "loop",
      "label": "t:sections.image-carousel.settings.loop.label",
      "default": true
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:settings.color_scheme",
      "default": "scheme-1"
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "t:sections.image-carousel.blocks.slide.name",
      "limit": 6,
      "settings": [
        {
          "type": "header",
          "content": "t:sections.image-carousel.blocks.slide.header__1.content"
        },
        {
          "type": "image_picker",
          "id": "mobile_image",
          "label": "t:sections.image-carousel.blocks.slide.mobile_image.label"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "t:sections.image-carousel.blocks.slide.image.label"
        },
        {
          "type": "header",
          "content": "t:sections.image-carousel.blocks.slide.header__2.content"
        },
        {
          "type": "textarea",
          "id": "title",
          "label": "t:sections.image-carousel.blocks.slide.title.label",
          "default": "Heading"
        },
        {
          "type": "textarea",
          "id": "subtitle",
          "label": "t:sections.image-carousel.blocks.slide.subtitle.label",
          "default": "Subheading"
        },
        {
          "type": "select",
          "id": "alignment",
          "label": "t:sections.image-carousel.blocks.slide.alignment.label",
          "options": [
            {
              "value": "justify-items-start text-start",
              "label": "t:sections.image-carousel.blocks.slide.alignment.options__1.label"
            },
            {
              "value": "justify-items-center text-center",
              "label": "t:sections.image-carousel.blocks.slide.alignment.options__2.label"
            },
            {
              "value": "justify-items-end text-end",
              "label": "t:sections.image-carousel.blocks.slide.alignment.options__3.label"
            }
          ],
          "default": "justify-items-start text-start"
        },
        {
          "type": "text",
          "id": "link_label",
          "label": "t:sections.image-carousel.blocks.slide.link_label.label",
          "default": "Show Now"
        },
        {
          "type": "url",
          "id": "link",
          "label": "t:sections.image-carousel.blocks.slide.link.label"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "t:sections.image-carousel.presets.name",
      "blocks": [
        {
          "type": "slide"
        },
        {
          "type": "slide"
        },
        {
          "type": "slide"
        }
      ]
    }
  ]
}
{% endschema %}
